<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<title>Living Wage Calculator</title>
	<link rel="stylesheet" href="lwc.css" />
	<style>
	#lwcContainer svg {
		border: solid;
		border-width: 1px;
		width: inherit;
		height: inherit;
	}

	#lwcContainer > div {
		/*
		This hopefully sets an aspect ratio approx. 1.695:1
		Arrived at by prnt-screen and cropping down to a good size
		based on the US map... which lead to 1268x748
		748/1268 * 100 ~ 59% since we're basing on 100% height
		*/
		width: 169.5vh;
		height: 100vh;
	}

	body {
		margin: 0px;
	}

	#dataContainer {
		width: 100%;
		margin: 25px;
	}
	</style>
</head>

<body>

	<script src="//d3js.org/d3.v3.min.js"></script>
	<script src="//d3js.org/queue.v1.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script> 

	<div style="height: 100%; display: flex;">
		<div id="lwcContainer" style="height: 100%; flex-grow: 12;"></div>
		<div id="dataContainer">
			<div style="margin-bottom: 10px;">
			<label for="modelSelect">Model:</label><select id="modelSelect">
				<option selected>A Model</option>
			</select>
			</div>

			<div>
			<label for="familySelect">Family:</label>
			<select id="familySelect">
				<option selected value="1adult">1 Adult</option>
				<option value="1adult1">1 Adult + 1 Child</option>
				<option value="1adult2">1 Adult + 2 Children</option>
				<option value="1adult3">1 Adult + 3 Children</option>
				<option value="2adults">2 Adults</option>
				<option value="2adults1">2 Adults + 1 Child</option>
				<option value="2adults2">2 Adults + 2 Children</option>
				<option value="2adults3">2 Adults + 3 Children</option>
			</select>
			</div>

			<div id="barchart"></div>
		</div>

	<script src="map.js"></script>
	<script src="barchart.js"></script>

	<script>
		lwcMap = UsMap; // want to make this a proper object at some point...

		

		rateById = d3.map();
		dataById = d3.map();

		var dataDeferred = queue().defer(d3.csv, "data/Calc.csv", function(d) {
	      var fips = d['fips']
	      if (fips[0] == '0') {
	        fips = fips.substr(1);
	      }

	      if (fips.endsWith('99999')) {
	      	fips = fips.substring(0, fips.length - 5);

	      }
	      rateById.set(fips, +d['total_cost']);
	      dataById.set(fips, d);
	    });

	    lwcMap = new UsMap(document.getElementById('lwcContainer'), function() {
	    	// This stuff is to handle race conditions between loading the csv and the map initialization.
	    	dataDeferred.await(function(error) {
		    	if (error) throw error;
		    	console.log("data loaded");

		    	lwcMap.recolor(rateById);
	    	});
	    });

	    lwcMap.addTooltipHandler(function(d) {
	    	return "Living Wage: $" + (rateById.get(d.id)).toFixed(2);
	    });

	    var mainBarChart = new barchart(d3.select('#barchart'));

	    // Hacky way to connect mouseover events to barchart
	    lwcMap.overCounty = function(d) {
	    	mainBarChart.update(dataById.get(d.id));
	    }
	</script>
</body>